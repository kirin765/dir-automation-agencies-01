---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { getAll } from '../../scripts/process-data';

const listings = getAll();
const agency = Astro.url.searchParams.get('agency') || '';
const selectedListing = listings.find(l => l.slug === agency);
const success = Astro.url.searchParams.get('submitted') === '1';
---

<Layout title="Contact Agency" noindex={true}>
  <Header />
  <main class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-3xl font-bold mb-4">Contact an Agency</h1>
    <p class="text-slate-400 mb-8">Send your project details. We will forward this lead to the right team.</p>
    {success && <p class="mb-4 text-green-400">Thanks! Your message was sent.</p>}

    <form
      method="POST"
      action="/api/contact"
      class="space-y-6"
      data-track-form="lead_form_submit"
      data-listing={selectedListing?.slug || ''}
    >
      <input type="hidden" name="cf-turnstile-response" value="" />
      <div>
        <label class="block text-sm text-slate-400 mb-2">Agency *</label>
        <select name="listingSlug" required class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white">
          <option value="">Select agency</option>
          {listings.map(listing => (
            <option value={listing.slug} selected={agency === listing.slug}>{listing.name}</option>
          ))}
        </select>
      </div>
      <input name="name" required placeholder="Your name" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white" />
      <input type="email" name="email" required placeholder="Your email" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white" />
      <input name="budget" placeholder="Budget (optional)" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white" />
      <textarea name="message" required rows="5" placeholder="Project details" class="w-full px-4 py-3 bg-slate-800 border border-slate-700 rounded-xl text-white"></textarea>
      <button type="submit" class="w-full px-6 py-3 bg-green-500 hover:bg-green-600 text-black font-semibold rounded-xl">Send Inquiry</button>
    </form>
  </main>
  <Footer />
</Layout>
